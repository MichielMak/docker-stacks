{
  "extends": [
    "config:recommended",
    ":dependencyDashboard",
    ":pinDigests",
    ":semanticCommits",
    ":timezone(Europe/Amsterdam)"
  ],
  "prHourlyLimit": 5,
  "prConcurrentLimit": 10,
  "labels": ["renovate", "deps"],
  "rangeStrategy": "pin",

  "packageRules": [
    /* ---------- per-stack grouping ---------- */
    {
      "matchFileNames": ["authentik/**"],
      "groupName": "authentik stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["bazarr/**"],
      "groupName": "bazarr stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["mealie/**"],
      "groupName": "mealie stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["musicassistant/**"],
      "groupName": "musicassistant stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["ollama/**"],
      "groupName": "ollama stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["dockerproxy/**"],
      "groupName": "dockerproxy stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["firefox/**"],
      "groupName": "firefox stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },
    {
      "matchFileNames": ["cwa-bd/**"],
      "groupName": "cwa-bd stack",
      "matchUpdateTypes": ["minor", "patch", "digest"]
    },

    /* ---------- special cases ---------- */
    {
      "description": "Authentik uses CalVer (YYYY.M.P)",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["ghcr.io/goauthentik/server"],
      "versioning": "regex:^(?<year>\\d{4})\\.(?<minor>\\d{1,2})\\.(?<patch>\\d+)$"
    },
    {
      "description": "Stay on Postgres 16.x unless you intentionally bump",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["postgres"],
      "allowedVersions": "16.x",
      "matchUpdateTypes": ["minor", "patch"]
    },

    /* ---------- safer automerge defaults ---------- */
    {
      "description": "Auto-merge low-risk updates (patch/digest) for common homelab images",
      "matchDatasources": ["docker"],
      "matchPackagePatterns": [
        "^lscr\\.io/linuxserver/.*",
        "^ghcr\\.io/linuxserver/.*",
        "^ollama/ollama$"
      ],
      "matchUpdateTypes": ["patch", "digest"],
      "automerge": true
    },
    {
      "description": "Never auto-merge majors",
      "matchDatasources": ["docker"],
      "matchUpdateTypes": ["major"],
      "automerge": false
    },

    /* ---------- make security-ish patches more visible ---------- */
    {
      "description": "Raise priority for patch updates",
      "matchUpdateTypes": ["patch"],
      "prPriority": 10
    }
  ]
}