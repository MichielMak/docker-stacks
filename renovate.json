{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended", ":enableVulnerabilityAlerts"],
  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Renovate Dependency Dashboard Michiel",
  "dependencyDashboardHeader": "This issue contains a list of Renovate updates and statuses.",
  "timezone": "Europe/Amsterdam",
  "assigneesFromCodeOwners": true,
  "enabledManagers": ["docker-compose"],
  "labels": ["renovate"],
  "prHourlyLimit": 6,
  "prConcurrentLimit": 10,
  "pinDigests": true,
  "automerge": true,
  "automergeType": "pr",
  "platformAutomerge": true,
  "pruneStaleBranches": true,
  "dependencyDashboardAutoclose": false,
  "rebaseWhen": "behind-base-branch",
  "branchConcurrentLimit": 10,
  "gitIgnoredAuthors": ["self-hosted-renovate-mm"],
  "packageRules": [
    {
      "description": "Globally ignore unversioned/channel/hash-only docker tags",
      "matchDatasources": ["docker"],
      "allowedVersions": "!/^(latest|stable|release|edge|rolling|nightly|master|main)$|^[a-f0-9]{7,}$|^pr-plugins-[a-f0-9]{7,}$/i"
    },
    {
      "description": "Ignore prerelease (alpha, beta, rc, aN/bN) docker tags",
      "matchDatasources": ["docker"],
      "allowedVersions": "!/(alpha|beta|rc|dev|snapshot|canary|nightly|preview|experimental|\\d+[ab]\\d+)/i"
    },
    {
      "description": "Ignore bare YYYYMMDD docker tags",
      "matchDatasources": ["docker"],
      "allowedVersions": "!/^20\\d{2}(0\\d|1[0-2])(0\\d|[12]\\d|3[01])$/"
    },
    {
      "description": "Hotio: parse release-/pr-plugins- <semver> tags",
      "matchPackageNames": ["/^ghcr\\.io\\/hotio\\//"],
      "versioning": "regex:^(?:release-|pr-plugins-)?(?<major>\\d+)\\.(?<minor>\\d+)\\.(?<patch>\\d+)(?:\\.(?<build>\\d+))?$"
    },
    {
      "description": "LinuxServer: parse <version>-lsNNN tags",
      "matchPackageNames": ["/^lscr\\.io\\/linuxserver\\//"],
      "versioning": "regex:^(?<major>\\d+)(?:\\.(?<minor>\\d+))?(?:\\.(?<patch>\\d+))?(?:\\.(?<build>\\d+))?-ls\\d+(?:-.*)?$"
    },
    {
      "description": "GHCR: normalize 'v' prefix; accept SemVer + CalVer",
      "matchDatasources": ["docker"],
      "matchPackageNames": ["/^ghcr\\.io\\//"],
      "extractVersion": "^v?(?<version>.*)$",
      "versioning": "loose"
    },
    {
      "description": "Postgres: only track 16.x (including distro suffixes)",
      "matchPackageNames": ["/^docker\\.io\\/library\\/postgres$/"],
      "allowedVersions": "/^16(?:\\.\\d+){0,2}(?:-[A-Za-z0-9.-]+)?$/"
    },
    {
      "description": "Group updates strictly per compose file directory",
      "matchManagers": ["docker-compose"],
      "matchFileNames": ["**/compose.yaml", "**/compose.yml", "**/docker-compose.yaml", "**/docker-compose.yml"],
      "groupName": "stack: {{parentDir}}",
      "groupSlug": "stack-{{parentDir}}",
      "addLabels": ["stack:{{parentDir}}"]
    },
    {
      "description": "Minimum release age for Docker to avoid fresh-tag churn",
      "matchDatasources": ["docker"],
      "minimumReleaseAge": "12 hours"
    },
    {
      "description": "Open PRs immediately for digest/minor/patch; majors stay separate",
      "matchDatasources": ["docker"],
      "separateMajorMinor": true
    },
    {
      "description": "Swap floating docker tags to numbered tags (SemVer or CalVer) when available",
      "matchDatasources": ["docker"],
      "matchCurrentVersion": "/^(latest|stable|release|edge)$/i",
      "rangeStrategy": "replace",
      "allowedVersions": "/^(?:\\d+(?:\\.\\d+){1,2}(?:[-._][A-Za-z0-9]+)?)|(20\\d{2}\\.\\d{1,2}(?:\\.\\d+)?)$/",
      "versioning": "loose"
    }
  ],
  "hostRules": [
    { "matchHost": "ghcr.io", "hostType": "docker", "concurrentRequestLimit": 2, "timeout": 120000 },
    { "matchHost": "lscr.io", "hostType": "docker", "concurrentRequestLimit": 2, "timeout": 120000 },
    { "matchHost": "registry-1.docker.io", "hostType": "docker", "concurrentRequestLimit": 2, "timeout": 120000 }
  ]
}