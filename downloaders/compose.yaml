x-lockdown: &lockdown
  # prevents write access to the image itself
  read_only: true
  # prevents any process within the container to gain more privileges
  security_opt:
    - "no-new-privileges=true"

services:
  qbittorrent:
    image: ghcr.io/hotio/qbittorrent:release-5.1.2@sha256:cec9ab4fbd139cd3fdc1556bb0cc498303735d427d5ceaa2e2f864341d535df1
    container_name: qbittorrent
    environment:
      - TZ=Europe/Amsterdam
      - PUID=${PUID}
      - PGID=${PGID}
      - UMASK=002
      - WEBUI_PORTS=8080/tcp,8080/udp
      - LIBTORRENT=v1
    volumes:
      - ${DOCKER_DATA_DIR}/qbittorrent/config:/config
      - ${MEDIA_DIR}/downloads/torrents:/media/downloads/torrents
      - ${OVERIG_DIR}/prestage:/overig/prestage
    ports:
      - 6881:6881/tcp
      - 6881:6881/udp
    labels:
      - homepage.group=Infra
      - homepage.name=Qbittorrent
      - homepage.icon=qbittorrent.png
      - homepage.href=http://qbittorrent.$DOMAIN/
      - homepage.description=Torrent client
      - homepage.widget.type=qbittorrent
      - homepage.widget.url=http://qbittorrent:8080
    restart: unless-stopped
    networks:
      - npm
  sabnzbd:
    image: 11notes/sabnzbd:4.5.3@sha256:95af7758f4e04cd7a73fd8c2aad2f3c2b9849a71c8590b3ed11a5749bbc617bf
    <<: *lockdown
    container_name: sabnzbd
    user: "568:568"
    command: ["/usr/local/bin/python", "/opt/sabnzbd/SABnzbd.py", "--config-file", "/sabnzbd/etc/sabnzbd.ini", "--server", "0.0.0.0:8080", "--browser", "0", "--console", "--logging", "1", "--disable-file-log"]
    environment:
      - TZ=Europe/Amsterdam
    volumes:
      - sabnzbd.etc:/sabnzbd/etc
      - ${MEDIA_DIR}/downloads/usenet:/media/downloads/usenet
      - ${OVERIG_DIR}/prestage:/overig/prestage
    ports:
      - 8080:8080
    tmpfs:
      # required for read-only image
      - "/tmp:uid=568,gid=568"
    labels:
      - homepage.group=Infra
      - homepage.name=SABnzbd
      - homepage.icon=sabnzbd.png
      - homepage.href=http://sabnzbd.$DOMAIN/
      - homepage.description=Usenet client
      - homepage.widget.type=sabnzbd
      - homepage.widget.url=http://sabnzbd:8080
      - homepage.widget.key=${SABNZBD_API}
    restart: unless-stopped
    networks:
      - npm
  pyload:
    image: linuxserver/pyload-ng:0.5.0@sha256:2c99abd3d4f3a68ff322efb0fb0cd2da40890ed38c9c4cca0a1573ec98e5315e
    container_name: pyload
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Amsterdam
    volumes:
      - ${DOCKER_DATA_DIR}/pyload/config:/config
      - ${MEDIA_DIR}/downloads/pyload:/downloads
    #    ports:
    #      - 8000:8000
    #      - 9666:9666 #optional
    restart: unless-stopped
    networks:
      - npm
    labels:
      - homepage.group=Infra
      - homepage.name=Pyload
      - homepage.icon=pyload.png
      - homepage.href=http://pyload.$DOMAIN/
      - homepage.description=Free and Open Source download manager
      - homepage.widget.type=pyload
      - homepage.widget.fields=["speed", "active", "queue"]
      - homepage.widget.url=http://pyload:8000
      - homepage.widget.username=pyload
      - homepage.widget.password=${PYLOAD_PW}
networks:
  npm:
    external: true
volumes:
  sabnzbd.etc:
    driver: local