x-lockdown: &lockdown
  # prevents write access to the image itself
  read_only: true
  # prevents any process within the container to gain more privileges
  security_opt:
    - "no-new-privileges=true"

services:
  qbittorrent:
    image: 11notes/qbittorrent:5.1.2@sha256:aff054f9d3b7ccfb0055265315079b1d90df7a7264ffb01a7cd80ec4af505811
    <<: *lockdown
    container_name: qbittorrent
    user: "568:568"
    command: ["/usr/local/bin/qbittorrent", "--profile=/config"]
    environment:
      - TZ=Europe/Amsterdam
      - UMASK=002
      - WEBUI_PORTS=8080/tcp,8080/udp
      - LIBTORRENT=v1
    volumes:
      - qbittorrent.etc:/qbittorrent/etc
      - qbittorrent.var:/qbittorrent/var
      - ${DOCKER_DATA_DIR}/qbittorrent/config:/config
      - ${MEDIA_DIR}/downloads/torrents:/media/downloads/torrents
      - ${OVERIG_DIR}/prestage:/overig/prestage
    ports:
      - 6881:6881/tcp
      - 6881:6881/udp
    labels:
      - homepage.group=Infra
      - homepage.name=Qbittorrent
      - homepage.icon=qbittorrent.png
      - homepage.href=http://qbittorrent.$DOMAIN/
      - homepage.description=Torrent client
      - homepage.widget.type=qbittorrent
      - homepage.widget.url=http://qbittorrent:8080
    restart: unless-stopped
    networks:
      - npm
  sabnzbd:
    image: 11notes/sabnzbd:4.5.3@sha256:86d343547048e96e929df555c6acd01c908c51c39f0e76c8806819fd6083395c
    <<: *lockdown
    container_name: sabnzbd
    user: "568:568"
    command: ["/usr/local/bin/python", "/opt/sabnzbd/SABnzbd.py", "--config-file", "/sabnzbd/etc/sabnzbd.ini", "--server", "0.0.0.0:8080", "--browser", "0", "--console", "--logging", "1", "--disable-file-log"]
    environment:
      - TZ=Europe/Amsterdam
    volumes:
      - sabnzbd.etc:/sabnzbd/etc
      - ${MEDIA_DIR}/downloads/usenet:/media/downloads/usenet
      - ${OVERIG_DIR}/prestage:/overig/prestage
    ports:
      - 8080:8080
    tmpfs:
      # required for read-only image
      - "/tmp:uid=568,gid=568"
    labels:
      - homepage.group=Infra
      - homepage.name=SABnzbd
      - homepage.icon=sabnzbd.png
      - homepage.href=http://sabnzbd.$DOMAIN/
      - homepage.description=Usenet client
      - homepage.widget.type=sabnzbd
      - homepage.widget.url=http://sabnzbd:8080
      - homepage.widget.key=${SABNZBD_API}
    restart: unless-stopped
    networks:
      - npm
  pyload:
    image: linuxserver/pyload-ng:0.5.0@sha256:1a3b961113177cf0b31ccdaba64b10447f22f898f27bba4305c632d1cc72473c
    container_name: pyload
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Amsterdam
    volumes:
      - ${DOCKER_DATA_DIR}/pyload/config:/config
      - ${MEDIA_DIR}/downloads/pyload:/downloads
    #    ports:
    #      - 8000:8000
    #      - 9666:9666 #optional
    restart: unless-stopped
    networks:
      - npm
    labels:
      - homepage.group=Infra
      - homepage.name=Pyload
      - homepage.icon=pyload.png
      - homepage.href=http://pyload.$DOMAIN/
      - homepage.description=Free and Open Source download manager
      - homepage.widget.type=pyload
      - homepage.widget.fields=["speed", "active", "queue"]
      - homepage.widget.url=http://pyload:8000
      - homepage.widget.username=pyload
      - homepage.widget.password=${PYLOAD_PW}
networks:
  npm:
    external: true
volumes:
  sabnzbd.etc:
    driver: local
  qbittorrent.etc:
    driver: local
  qbittorrent.var:
    driver: local