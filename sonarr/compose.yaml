services:
  sonarr:
    image: linuxserver/sonarr:4.0.15@sha256:1a90192952c30f9420994b2e2171083ea8cae100357de5e9eb25890efa90a6ce
    container_name: sonarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Amsterdam
      - DOCKER_MODS=ghcr.io/tailscale-dev/docker-mod:main # Tailscale integration
      - TAILSCALE_STATE_DIR=/var/lib/tailscale  # Tailscale state directory
      - TAILSCALE_SERVE_PORT=8989   # Port for Tailscale to serve Sonarr
      - TAILSCALE_SERVE_MODE=https  # Use HTTPS for Tailscale serving
      - TAILSCALE_AUTHKEY=${TAILSCALE_AUTHKEY}  # Tailscale auth key
      - TAILSCALE_HOSTNAME=sonarr # Hostname for Tailscale
      - TAILSCALE_USE_SSH=0 # Disable SSH for Tailscale
    volumes:
      - ${DOCKER_DATA_DIR}/sonarr/config:/config
      - ${MEDIA_DIR}:/media 
      - ${DOCKER_DATA_DIR}/sonarr/tailscale:/var/lib/tailscale
    #    ports:
    #      - 8989:8989
    labels:
      - homepage.group=Media Management
      - homepage.name=Sonarr
      - homepage.icon=sonarr.png
      - homepage.href=http://sonarr.${DOMAIN}/
      - homepage.description=Series management
      - homepage.widget.type=sonarr
      - homepage.widget.url=http://sonarr:8989
      - homepage.widget.key=${SONARR_API}
    restart: unless-stopped
    networks:
      - npm
  sonarrexternal:
    image: linuxserver/sonarr:4.0.15@sha256:1a90192952c30f9420994b2e2171083ea8cae100357de5e9eb25890efa90a6ce
    container_name: sonarrexternal
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=Europe/Amsterdam
    volumes:
      - ${DOCKER_DATA_DIR}/sonarrexternal/config:/config
      - ${MEDIA_DIR}:/media #optional
    #    ports:
    #      - 8989:8989
    labels:
      - homepage.group=Media Management
      - homepage.name=Sonarr external
      - homepage.icon=sonarr.png
      - homepage.href=http://sonarrexternal.${DOMAIN}/
      - homepage.description=Series management
      - homepage.widget.type=sonarr
      - homepage.widget.url=http://sonarrexternal:8989
      - homepage.widget.key=${SONARREXTERNAL_API}
    restart: unless-stopped
    networks:
      - npm
networks:
  npm:
    external: true