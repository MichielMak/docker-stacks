services:
  prowlarr:
    image: 11notes/prowlarr:2.1.5@sha256:d597eafdbef4e7708e6ec9399788a20a9213cf7c15819c1cd1912dd2fddaa762
    container_name: prowlarr
    read_only: true
    tmpfs:
      - /tmp:uid=${PUID},gid=${PGID}
    environment:
      TZ: Europe/Amsterdam
    user: ${PUID}:${PGID}
    volumes:
      - ${DOCKER_DATA_DIR}/prowlarr/config:/prowlarr/etc
    #    ports:
    #      - 9696:9696
    labels:
      - homepage.group=Media Management
      - homepage.name=Prowlarr
      - homepage.icon=prowlarr.png
      - homepage.href=http://prowlarr.${DOMAIN}/
      - homepage.description=Indexer management
      - homepage.widget.type=prowlarr
      - homepage.widget.fields=["numberOfGrabs", "numberOfQueries"]
      - homepage.widget.url=http://prowlarr:9696
      - homepage.widget.key=${PROWLARR_API}
      - tsdproxy.enable=true
      - tsdproxy.container_port=9696
      - traefik.enable=true
      - traefik.docker.network=npm
      - traefik.http.routers.prowlarr.rule=Host(`prowlarr.${DOMAIN}`)
      - traefik.http.routers.prowlarr.entrypoints=websecure
      - traefik.http.routers.prowlarr.tls=true
      - traefik.http.services.prowlarr.loadbalancer.server.port=9696
    restart: unless-stopped
    networks:
      - npm
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://127.0.0.1:9696/ping"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
networks:
  npm:
    external: true
